<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>胖大人的日常记事</title>
    <meta name="description" content="Just playing around">
    <link rel="icon" href="/logo.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.d6cdabc1.css" as="style"><link rel="preload" href="/assets/js/app.92625234.js" as="script"><link rel="preload" href="/assets/js/2.38d85b4c.js" as="script"><link rel="preload" href="/assets/js/10.1a50f243.js" as="script"><link rel="prefetch" href="/assets/js/11.bad254af.js"><link rel="prefetch" href="/assets/js/12.56baed48.js"><link rel="prefetch" href="/assets/js/13.7055bfb2.js"><link rel="prefetch" href="/assets/js/14.eb7e1e0e.js"><link rel="prefetch" href="/assets/js/15.20ae4527.js"><link rel="prefetch" href="/assets/js/16.53f5f52a.js"><link rel="prefetch" href="/assets/js/17.559421a0.js"><link rel="prefetch" href="/assets/js/18.2a06a394.js"><link rel="prefetch" href="/assets/js/19.42604d4f.js"><link rel="prefetch" href="/assets/js/20.52090e26.js"><link rel="prefetch" href="/assets/js/21.dd9ac026.js"><link rel="prefetch" href="/assets/js/22.21f5f57a.js"><link rel="prefetch" href="/assets/js/23.b2f0989f.js"><link rel="prefetch" href="/assets/js/24.ec557b6b.js"><link rel="prefetch" href="/assets/js/25.6644ec66.js"><link rel="prefetch" href="/assets/js/26.60483ab2.js"><link rel="prefetch" href="/assets/js/27.3798eaab.js"><link rel="prefetch" href="/assets/js/28.8d842cc3.js"><link rel="prefetch" href="/assets/js/29.7c4d8f6b.js"><link rel="prefetch" href="/assets/js/3.a2e674c2.js"><link rel="prefetch" href="/assets/js/30.b105f212.js"><link rel="prefetch" href="/assets/js/31.01c7643e.js"><link rel="prefetch" href="/assets/js/32.45e721ae.js"><link rel="prefetch" href="/assets/js/33.567b3ff4.js"><link rel="prefetch" href="/assets/js/34.d9579cd9.js"><link rel="prefetch" href="/assets/js/35.3a605990.js"><link rel="prefetch" href="/assets/js/36.7321ee72.js"><link rel="prefetch" href="/assets/js/37.663a1ee1.js"><link rel="prefetch" href="/assets/js/4.6352c09c.js"><link rel="prefetch" href="/assets/js/5.ae17a9ef.js"><link rel="prefetch" href="/assets/js/6.c1d31416.js"><link rel="prefetch" href="/assets/js/7.a0ef9559.js"><link rel="prefetch" href="/assets/js/8.817ff80f.js"><link rel="prefetch" href="/assets/js/9.d271e8c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6cdabc1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">胖大人的日常记事</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/0001.html" class="sidebar-link">01 开篇词 | 使用 Webpack 实现前端工程化</a></li><li><a href="/0002.html" class="sidebar-link">02 什么是 Webpack</a></li><li><a href="/0003.html" class="sidebar-link">03 Webpack 开发环境搭建</a></li><li><a href="/0004.html" class="sidebar-link">04 使用 webpack-cli 体验零配置打包</a></li><li><a href="/0005.html" class="active sidebar-link">05 基础概念和常见配置项介绍（一）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/0005.html#webpack-config-js-配置文件" class="sidebar-link">webpack.config.js 配置文件</a></li><li class="sidebar-sub-header"><a href="/0005.html#webpack-配置支持多种语言" class="sidebar-link">Webpack 配置支持多种语言</a></li><li class="sidebar-sub-header"><a href="/0005.html#webpack-常见名词解释" class="sidebar-link">Webpack 常见名词解释</a></li><li class="sidebar-sub-header"><a href="/0005.html#mode-模式" class="sidebar-link">mode 模式</a></li><li class="sidebar-sub-header"><a href="/0005.html#webpack-的入口（entry）和输出（output）" class="sidebar-link">Webpack 的入口（entry）和输出（output）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/0005.html#单文件入口" class="sidebar-link">单文件入口</a></li><li class="sidebar-sub-header"><a href="/0005.html#多文件入口" class="sidebar-link">多文件入口</a></li><li class="sidebar-sub-header"><a href="/0005.html#output-publicpath" class="sidebar-link">output.publicPath</a></li><li class="sidebar-sub-header"><a href="/0005.html#output-library" class="sidebar-link">output.library</a></li><li class="sidebar-sub-header"><a href="/0005.html#output-librarytarget" class="sidebar-link">output.libraryTarget</a></li></ul></li><li class="sidebar-sub-header"><a href="/0005.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/0006.html" class="sidebar-link">06 基础概念和常见配置项介绍（二）</a></li><li><a href="/0007.html" class="sidebar-link">07 Webpack 中的模块化开发</a></li><li><a href="/0008.html" class="sidebar-link">08 在 Webpack 中使用 Babel 转换 JavaScript 代码</a></li><li><a href="/0009.html" class="sidebar-link">09 Webpack 中使用 TypeScript 开发项目</a></li><li><a href="/0010.html" class="sidebar-link">10 Webpack 中样式相关的配置</a></li><li><a href="/0011.html" class="sidebar-link">11 Webpack 中使用 lint 工具来保证代码风格和质量</a></li><li><a href="/0012.html" class="sidebar-link">12 使用 Webpack 管理项目中的静态资源</a></li><li><a href="/0013.html" class="sidebar-link">13 Webpack 中打包 HTML 和多页面配置</a></li><li><a href="/0014.html" class="sidebar-link">14 Webpack Dev Server 本地开发服务</a></li><li><a href="/0015.html" class="sidebar-link">15 Webpack 中配置React和Vue开发环境</a></li><li><a href="/0016.html" class="sidebar-link">16 Webpack 环境相关配置及配置文件拆分</a></li><li><a href="/0017.html" class="sidebar-link">17 Webpack 优化之体积优化</a></li><li><a href="/0018.html" class="sidebar-link">18 Webpack 优化之增强缓存命中率</a></li><li><a href="/0019.html" class="sidebar-link">19 使用 Webpack 的 splitChunks 功能来拆分代码</a></li><li><a href="/0020.html" class="sidebar-link">20 Webpack 优化之速度优化</a></li><li><a href="/0021.html" class="sidebar-link">21 使用 Webpack 的 Tree-Shaking</a></li><li><a href="/0022.html" class="sidebar-link">22 为你准备了一份 Webpack 工程化最佳实践总结</a></li><li><a href="/0023.html" class="sidebar-link">23 怎么调试 Webpack？</a></li><li><a href="/0024.html" class="sidebar-link">24 Tapable —— Webpack 的核心模块</a></li><li><a href="/0025.html" class="sidebar-link">25 Webpack 的 Compiler 和 Compilation</a></li><li><a href="/0026.html" class="sidebar-link">26 Webpack 工作流程</a></li><li><a href="/0027.html" class="sidebar-link">27 从 Webpack 的产出代码来看 Webpack 是怎么执行的</a></li><li><a href="/0028.html" class="sidebar-link">28 Webpack 的模块热替换做了什么？</a></li><li><a href="/0029.html" class="sidebar-link">29 实战：使用 PostCSS 打造移动适配方案</a></li><li><a href="/0030.html" class="sidebar-link">30 实战：手写一个 markdown-loader</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img src="https://img1.mukewang.com/5cd962fd000101b306400360.jpg" alt=""></p> <blockquote><p>人生太短，要干的事太多，我要争分夺秒。</p> <p>               ——爱迪生</p></blockquote> <p>本节介绍下跟 Webpack 配置相关的概念，以及介绍一个简单并且常用的配置项。</p> <h2 id="webpack-config-js-配置文件"><a href="#webpack-config-js-配置文件" aria-hidden="true" class="header-anchor">#</a> webpack.config.js 配置文件</h2> <p>Webpack 是可配置的模块打包工具，我们可以通过修改 Webpack 的配置文件（webpack.config.js）来对 Webpack 进行配置，Webpack 的配置文件是遵循 Node.js 的 CommonJS 模块规范的，即：</p> <ul><li>通过require()语法导入其他文件或者使用 Node.js 内置的模块</li> <li>普通的 JavaScript 编写语法，包括变量、函数、表达式等</li> <li></li></ul> <p>说白了，webpack.config.js是一个 Node.js 的模块。</p> <p><strong>简单的 webpack.config.js 示例</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token string">'./foo.js'</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'foo.bundle.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面示例中，使用 CommonJS 的require引入 Node.js 内置的path模块，然后通过module.exports将 Webpack 的配置导出。</p> <blockquote><p><em><strong>Tips：</strong></em> Webpack 的配置是一个 Node.js 模块，所以并不只是 JSON 对象。</p></blockquote> <h2 id="webpack-配置支持多种语言"><a href="#webpack-配置支持多种语言" aria-hidden="true" class="header-anchor">#</a> Webpack 配置支持多种语言</h2> <p>Webpack 不仅仅支持 js 配置，还支持 ts（TypeScript）、CoffeeScript 甚至 <a href="https://reactjs.org/docs/introducing-jsx.html" target="_blank" rel="noopener noreferrer">JSX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 语法的配置，不同语言其实核心配置项都不变，只不过语法不同而已，<strong>本专栏都是 JavaScript 语法的配置</strong>。</p> <p>除了配置文件的语法多样之外，对于配置的类型也是多样的，最常见的是直接作为一个对象来使用，除了使用对象，Webpack 还支持函数、Promise 和多配置数组。</p> <h4 id="函数类型的-webpack-配置"><a href="#函数类型的-webpack-配置" aria-hidden="true" class="header-anchor">#</a> 函数类型的 Webpack 配置</h4> <p>如果我们只使用一个配置文件来区分生产环境（production）和开发环境（development），则可以使用函数类型的 Webpack 配置，函数类型的配置必须返回一个配置对象，如下面：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        mode<span class="token punctuation">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">'production'</span> <span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
        devtool<span class="token punctuation">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">'source-maps'</span> <span class="token punctuation">:</span> <span class="token string">'eval'</span><span class="token punctuation">,</span>
        plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                terserOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    compress<span class="token punctuation">:</span> argv<span class="token punctuation">[</span><span class="token string">'optimize-minimize'</span><span class="token punctuation">]</span> <span class="token comment">// 只有传入 -p 或 --optimize-minimize</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Webpack 配置函数接受两个参数env和argv：分别对应着环境对象和 Webpack-CLI 的命令行选项，例如上面代码中的--optimize-minimize。</p> <h4 id="promise-类型的-webpack-配置"><a href="#promise-类型的-webpack-配置" aria-hidden="true" class="header-anchor">#</a> Promise 类型的 Webpack 配置</h4> <p>如果需要异步加载一些 Webpack 配置需要做的变量，那么可以使用 Promise 的方式来做 Webpack 的配置，具体方式如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                entry<span class="token punctuation">:</span> <span class="token string">'./app.js'</span>
                <span class="token comment">/* ... */</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="多配置数组"><a href="#多配置数组" aria-hidden="true" class="header-anchor">#</a> 多配置数组</h4> <p>在一些特定的场景，我们可能需要一次打包多次，而多次打包中有一些通用的配置，这时候可以使用配置数组的方式，将两次以上的 Webpack 配置以数组的形式导出：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'production'</span>
    <span class="token comment">// 配置1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 配置2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="配置的使用"><a href="#配置的使用" aria-hidden="true" class="header-anchor">#</a> 配置的使用</h4> <p>默认情况下，Webpack 会查找执行目录下面的webpack.config.js作为配置，如果需要指定某个配置文件，可以使用下面的命令：</p> <div class="language- extra-class"><pre class="language-text"><code>webpack --config webpack.config.js
</code></pre></div><p>如果 Webpack 不是全局安装，则可以在项目目录下实行：</p> <div class="language- extra-class"><pre class="language-text"><code>node ./node_modules/webpack/bin/webpack --config webpack.config.js
</code></pre></div><p>或者使用npx</p> <div class="language- extra-class"><pre class="language-text"><code>npx webpack --config webpack.config.js
</code></pre></div><h2 id="webpack-常见名词解释"><a href="#webpack-常见名词解释" aria-hidden="true" class="header-anchor">#</a> Webpack 常见名词解释</h2> <p>讲完 Webpack 配置文件，下面讲下配置文件中的配置项。当我们谈论 Webpack 的时候，往往会提到下面的名词：</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>entry</td> <td>项目入口</td></tr> <tr><td>module</td> <td>开发中每一个文件都可以看做 module，模块不局限于 js，也包含 css、图片等</td></tr> <tr><td>chunk</td> <td>代码块，一个 chunk 可以由多个模块组成</td></tr> <tr><td>loader</td> <td>模块转化器，模块的处理器，对模块进行转换处理</td></tr> <tr><td>plugin</td> <td>扩展插件，插件可以处理 chunk，也可以对最后的打包结果进行处理，可以完成 loader 完不成的任务</td></tr> <tr><td>bundle</td> <td>最终打包完成的文件，一般就是和 chunk 一一对应的关系，bundle 就是对 chunk 进行便意压缩打包等处理后的产出</td></tr></tbody></table> <h2 id="mode-模式"><a href="#mode-模式" aria-hidden="true" class="header-anchor">#</a> mode 模式</h2> <p>Webpack4.0 开始引入了mode配置，通过配置mode=development或者mode=production来制定是开发环境打包，还是生产环境打包，比如生产环境代码需要压缩，图片需要优化，Webpack 默认mode是生产环境，即mode=production。</p> <p>除了在配置文件中设置mode：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>还可以在命令行中设置mode：</p> <div class="language- extra-class"><pre class="language-text"><code>npx webpack --config webpack.config.entry.js --mode development
</code></pre></div><p>下面的内容及其后续的章节内容，如没有声明，则以development方式来做演示，这样方便查看输出的结果。</p> <h2 id="webpack-的入口（entry）和输出（output）"><a href="#webpack-的入口（entry）和输出（output）" aria-hidden="true" class="header-anchor">#</a> Webpack 的入口（entry）和输出（output）</h2> <p>通过前面的文章我们已经了解到：<strong>webpack 是一个模块打包工具，能够从一个需要处理的 JavaScript 文件开始，构建一个依赖关系图（dependency graph），该图映射到了项目中每个模块，然后将这个依赖关系图输出到一个或者多个 bundle 中。</strong></p> <p>从上面文字的认识，可以轻易的得到 Webpack 的两个核心概念：entry和output，即入口和输出，Webpack 是从指定的入口文件（entry）开始，经过加工处理，最终按照output设定输出固定内容的 bundle；而这个加工处理的过程，就用到了loader和plugin两个工具；loader是源代码的处理器，plugin解决的是 loader处理不了的事情。今天重点介绍下entry和output，在后面文章在介绍loader和plugin。</p> <h4 id="context"><a href="#context" aria-hidden="true" class="header-anchor">#</a> context</h4> <p>在介绍entry之前，介绍下context（上下文），context即项目打包的相对路径上下文，如果指定了context=&quot;/User/test/webpack&quot;，那么我们设置的entry和output的相对路径都是相对于/User/test/webpack的，包括在 JavaScript 中引入模块也是从这个路径开始的。由于context的作用，决定了context值必须是一个绝对路径。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">:</span> <span class="token string">'/Users/test/webpack'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em><strong>Tips：</strong></em> 在实际开发中 context 一般不需要配置，不配置则默认为process.cwd()即工作目录。
工作目录（英语：Working directory），计算机用语。使用者在作业系统内所在的目录，使用者可在此用相对档名存取档案 —— 维基百科。</p></blockquote> <h4 id="entry入口"><a href="#entry入口" aria-hidden="true" class="header-anchor">#</a> entry入口</h4> <p>Webpack 的entry支持多种类型，包括字符串、对象、数组。从作用上来说，包括了单文件入口和多文件入口两种方式。</p> <h3 id="单文件入口"><a href="#单文件入口" aria-hidden="true" class="header-anchor">#</a> 单文件入口</h3> <p>单文件的用法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/file.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 或者使用对象方式</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        main<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/file.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>单文件入口可以快速创建一个只有单一文件入口的情况，例如 library 的封装，但是单文件入口的方式相对来说比较简单，在扩展配置的时候灵活性较低。</p> <p>entry还可以传入包含文件路径的数组，当entry为数组的时候也会合并输出，例如下面的配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span> <span class="token string">'./src/home.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'array.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em><strong>Tips：</strong></em> 上面配置无论是字符串还是字符串数组的 entry，实际上都是只有一个入口，但是在打包产出上会有差异：</p> <ol><li>如果直接是 string 的形式，那么 webpack 就会直接把该 string 指定的模块（文件）作为入口模块</li> <li>如果是数组 [string] 的形式，那么 webpack 会自动生成另外一个入口模块，并将数组中每个元素指定的模块（文件）加载进来，并将最后一个模块的 module.exports 作为入口模块的 module.exports 导出。<strong>这部分会在「原理篇：打包产出小节」继续做详细介绍。</strong></li></ol></blockquote> <h3 id="多文件入口"><a href="#多文件入口" aria-hidden="true" class="header-anchor">#</a> 多文件入口</h3> <p>多文件入口是使用对象语法来通过支持多个entry，多文件入口的对象语法相对于单文件入口，具有较高的灵活性，例如多页应用、页面模块分离优化。多文件入口的语法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    home<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/home.js'</span><span class="token punctuation">,</span>
    search<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/search.js'</span><span class="token punctuation">,</span>
    list<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/list.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的语法将entry分成了 3 个独立的入口文件，这样会打包出来三个对应的 bundle，在后面的文章还会介绍使用splitChunks抽离一个项目中多个entry的公共代码。</p> <blockquote><p><em><strong>Tips：</strong></em> 对于一个 HTML 页面，我们推荐只有一个 entry ，通过统一的入口，解析出来的依赖关系更方便管理和维护。</p></blockquote> <h4 id="output-输出"><a href="#output-输出" aria-hidden="true" class="header-anchor">#</a> output 输出</h4> <p>webpack 的output是指定了entry对应文件编译打包后的输出 bundle。output的常用属性是：</p> <ul><li>path：此选项制定了输出的 bundle 存放的路径，比如dist、output等</li> <li>filename：这个是 bundle 的名称</li> <li>publicPath：指定了一个在浏览器中被引用的 URL 地址，后面详细介绍
后面章节还会继续介绍不同项目的output其他属性，比如我们要使用 webpack 作为库的封装工具，会用到library和libraryTarget等。</li></ul> <blockquote><p><em><strong>Tips：</strong></em> 当不指定 output 的时候，默认输出到 dist/main.js ，即 output.path 是dist，output.filename 是 main。</p></blockquote> <p>一个 webpack 的配置，**可以包含多个entry，但是只能有一个output。**对于不同的entry可以通过output.filename占位符语法来区分，比如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        home<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/home.js'</span><span class="token punctuation">,</span>
        search<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/search.js'</span><span class="token punctuation">,</span>
        list<span class="token punctuation">:</span> <span class="token string">'path/to/my/entry/list.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其中[name]就是占位符，它对应的是entry的key（home、search、list），所以最终输出结果是：</p> <div class="language- extra-class"><pre class="language-text"><code>path/to/my/entry/home.js → dist/home.js
path/to/my/entry/search.js → dist/search.js
path/to/my/entry/list.js → dist/list.js
</code></pre></div><p>我将 Webpack 目前支持的占位符列出来：</p> <table><thead><tr><th>占位符</th> <th>含义</th></tr></thead> <tbody><tr><td>[hash]</td> <td>模块标识符的 hash</td></tr> <tr><td>[chunkhash]</td> <td>chunk 内容的 hash</td></tr> <tr><td>[name]</td> <td>模块名称</td></tr> <tr><td>[id]</td> <td>模块标识符</td></tr> <tr><td>[query]</td> <td>模块的 query，例如，文件名 ? 后面的字符串</td></tr> <tr><td>[function]</td> <td>一个 return 出一个 string 作为 filename 的函数</td></tr></tbody></table> <p>[hash] 和 [chunkhash] 的长度可以使用 [hash:16]（默认为 20）来指定。或者，通过指定 output.hashDigestLength 在全局配置长度，那么他们之间有什么区别吗？</p> <ul><li>[hash]：是<strong>整个项目</strong>的 hash 值，其根据每次编译内容计算得到，每次编译之后都会生成新的 hash，即修改任何文件都会导致所有文件的 hash 发生改变；在一个项目中虽然入口不同，但是 hash 是相同的；hash 无法实现前端静态资源在浏览器上长缓存，这时候应该使用 chunkhash；</li> <li>[chunkhash]：根据不同的入口文件（entry）进行依赖文件解析，构建对应的 chunk，生成相应的 hash；只要组成 entry 的模块文件没有变化，则对应的 hash 也是不变的，所以一般项目优化时，会将公共库代码拆分到一起，因为公共库代码变动较少的，使用 chunkhash 可以发挥最长缓存的作用；</li> <li>[contenthash]：使用 chunkhash 存在一个问题，当在一个 JS 文件中引入了 CSS 文件，编译后它们的 hash 是相同的。而且，只要 JS 文件内容发生改变，与其关联的 CSS 文件 hash 也会改变，针对这种情况，可以把 CSS 从 JS 中使用<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或 <a href="https://github.com/webpack-contrib/extract-text-webpack-plugin" target="_blank" rel="noopener noreferrer">extract-text-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>抽离出来并使用 contenthash。
[hash]、[chunkhash]和[contenthash]都支持[xxx:length]的语法。</li></ul> <blockquote><p><em><strong>Tips:</strong></em> 占位符是可以组合使用的，例如[name]-[hash:8]</p></blockquote> <h3 id="output-publicpath"><a href="#output-publicpath" aria-hidden="true" class="header-anchor">#</a> output.publicPath</h3> <p>对于使用&lt;script&gt; 和 &lt;link&gt;标签时，当文件路径不同于他们的本地磁盘路径（由output.path指定）时，output.publicPath被用来作为src或者link指向该文件。这种做法在需要将静态文件放在不同的域名或者 CDN 上面的时候是很有用的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> <span class="token string">'/home/git/public/assets'</span><span class="token punctuation">,</span>
        publicPath<span class="token punctuation">:</span> <span class="token string">'/assets/'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>则输出：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/assets/logo.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面的/assets/logo.png就是根据publicPath输出的，output.path制定了输出到本地磁盘的路径，而output.publicPath则作为实际上线到服务器之后的 url 地址。所以我们在上 CDN 的时候可以这样配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> <span class="token string">'/home/git/public/assets'</span><span class="token punctuation">,</span>
        publicPath<span class="token punctuation">:</span> <span class="token string">'http://cdn.example.com/assets/'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>则输出：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://cdn.example.com/assets/logo.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="output-library"><a href="#output-library" aria-hidden="true" class="header-anchor">#</a> output.library</h3> <p>如果我们打包的目的是生成一个供别人使用的库，那么可以使用output.library来指定库的名称，库的名称支持占位符和普通字符串：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span> <span class="token comment">// '[name]'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="output-librarytarget"><a href="#output-librarytarget" aria-hidden="true" class="header-anchor">#</a> output.libraryTarget</h3> <p>使用output.library 确定了库的名称之后，还可以使用output.libraryTarget指定库打包出来的规范，output.libraryTarget取值范围为：var、assign、this、window、global、commonjs、commonjs2、commonjs-module、amd、umd、umd2、jsonp，默认是var，下面通过打包后的代码不同，来看下差别。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// var config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'var.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'var'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token keyword">var</span> myLib <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// assign config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'assign.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'assign'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output： 少了个 var</span>
 myLib <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// this config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'this.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'this'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;myLib&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// window config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'window.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'window'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
window<span class="token punctuation">[</span><span class="token string">&quot;myLib&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ===============================================</span>
<span class="token comment">// global config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'global.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'global'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output：注意 target=node 的时候才是 global，默认 target=web下global 为 window</span>
window<span class="token punctuation">[</span><span class="token string">&quot;myLib&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// commonjs config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'commonjs.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'commonjs'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
exports<span class="token punctuation">[</span><span class="token string">&quot;myLib&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// amd config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'amd.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'amd'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'myLib'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ===============================================</span>
<span class="token comment">// umd config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'umd.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpackUniversalModuleDefinition</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> exports<span class="token punctuation">[</span><span class="token string">'myLib'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> root<span class="token punctuation">[</span><span class="token string">'myLib'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// commonjs2 config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'commonjs2.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'commonjs2'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// umd2 config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'umd2.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd2'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpackUniversalModuleDefinition</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> exports<span class="token punctuation">[</span><span class="token string">'myLib'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> root<span class="token punctuation">[</span><span class="token string">'myLib'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// commonjs-module config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'commonjs-module.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'commonjs-module'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// output</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ===============================================</span>
<span class="token comment">// jsonp config</span>
<span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        library<span class="token punctuation">:</span> <span class="token string">'myLib'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'jsonp.js'</span><span class="token punctuation">,</span>
        libraryTarget<span class="token punctuation">:</span> <span class="token string">'jsonp'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// output</span>
<span class="token function">myLib</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em><strong>注意：</strong></em> libraryTarget=global 的时候，如果 target=node 才是 global，默认 target=web 下 global 为 window，保险起见可以使用 this。</p></blockquote> <p>下面介绍下跟 output 输出相关的三个配置项：externals，target 和 devtool</p> <h4 id="externals"><a href="#externals" aria-hidden="true" class="header-anchor">#</a> externals</h4> <p>externals配置项用于去除输出的打包文件中依赖的某些第三方 js 模块（例如 jquery，vue 等等），减小打包文件的体积。该功能通常在开发自定义 js 库（library）的时候用到，用于去除自定义 js 库依赖的其他第三方 js 模块。这些被依赖的模块应该由使用者提供，而不应该包含在 js 库文件中。例如开发一个 jQuery 插件或者 Vue 扩展，不需要把 jQuery 和 Vue 打包进我们的 bundle，引入库的方式应该交给使用者。</p> <p>所以，这里就有个重要的问题，使用者应该怎么提供这些被依赖的模块给我们的 js 库（library）使用呢？这就要看我们的 js 库的导出方式是什么，以及使用者采用什么样的方式使用我们的库。例如：</p> <table><thead><tr><th>js library</th> <th>导出方式	output.libraryTarget</th> <th>使用者引入方式</th> <th>使用者提供给被依赖模块的方式</th></tr></thead> <tbody><tr><td>默认的导出方式</td> <td>output.libraryTarget=‘var’</td> <td>只能以 &lt;script&gt; 标签的形式引入我们的库</td> <td>只能以全局变量的形式提供这些被依赖的模块</td></tr> <tr><td>commonjs</td> <td>output.libraryTarget=‘commonjs’</td> <td>只能按照 commonjs 的规范引入我们的库</td> <td>被依赖模块需要按照 commonjs 规范引入</td></tr> <tr><td>amd</td> <td>output.libraryTarget=‘amd’</td> <td>只能按照 amd 规范引入</td> <td>被依赖模块需要按照 amd 规范引入</td></tr> <tr><td>umd</td> <td>output.libraryTarget=‘umd’</td> <td>可以用&lt;script&gt;、commonjs、amd 引入</td> <td>被依赖模块需要按照对应方式引入</td></tr></tbody></table> <p>如果不是在开发一个 js 库，即没有设置 output.library, output.libraryTarget 等配置信息，那么我们生成的打包文件只能以&lt;script&gt; 标签的方式在页面中引入，因此那些被去除的依赖模块也只能以全局变量的方式引入。</p> <h4 id="target"><a href="#target" aria-hidden="true" class="header-anchor">#</a> target</h4> <p>在项目开发中，我们不仅仅是开发 web 应用，还可能开发的是 Node.js 服务应用、或者 electron 这类跨平台桌面应用，这时候因为对应的宿主环境不同，所以在构建的时候需要特殊处理。webpack 中可以通过设置target来指定构建的目标（target）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">:</span> <span class="token string">'web'</span> <span class="token comment">// 默认是 web，可以省略</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>target的值有两种类型：string 和 function。</p> <p>string 类型支持下面的七种：</p> <ul><li>web：默认，编译为类浏览器环境里可用；</li> <li>node：编译为类 Node.js 环境可用（使用 Node.js require 加载 chunk）；</li> <li>async-node：编译为类 Node.js 环境可用（使用 fs 和 vm 异步加载分块）；</li> <li>electron-main：编译为 Electron 主进程；</li> <li>electron-renderer：编译为 Electron 渲染进程；</li> <li>node-webkit：编译为 Webkit 可用，并且使用 jsonp 去加载分块。支持 Node.js 内置模块和 nw.gui 导入（实验性质）；</li> <li>webworker：编译成一个 WebWorker。</li></ul> <p>后面章节介绍 webpack 特殊项目类型配置的时候还会介绍 target 相关的用法。</p> <p>除了string类型，target 还支持 function 类型，这个函数接收一个compiler作为参数，如下面代码可以用来增加插件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">target</span><span class="token punctuation">:</span> <span class="token parameter">compiler</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">compiler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>JsonpTemplatePlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>LoaderTargetPlugin</span><span class="token punctuation">(</span><span class="token string">'web'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="devtool"><a href="#devtool" aria-hidden="true" class="header-anchor">#</a> devtool</h4> <p>devtool是来控制怎么显示<a href="http://blog.teamtreehouse.com/introduction-source-maps" target="_blank" rel="noopener noreferrer">sourcemap<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，通过 sourcemap 我们可以快速还原代码的错误位置。</p> <p>但是由于 sourcemap 包含的数据量较大，而且生成算法需要计算量支持，所以 sourcemap 的生成会消耗打包的时间，下面的表格整理了不同的devtool值对应不同的 sourcemap 类型对应打包速度和特点。</p> <table><thead><tr><th>devtool</th> <th>构建速度</th> <th>重新构建速度</th> <th>生产环境</th> <th>品质(quality)</th></tr></thead> <tbody><tr><td>留空，none</td> <td>+++</td> <td>+++</td> <td>yes</td> <td>打包后的代码</td></tr> <tr><td>eval</td> <td>+++</td> <td>+++</td> <td>no</td> <td>生成后的代码</td></tr> <tr><td>cheap-eval-source-map</td> <td>+</td> <td>++</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-eval-source-map</td> <td>o</td> <td>++</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>eval-source-map</td> <td>–</td> <td>+</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>inline-cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>inline-cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>source-map</td> <td>–</td> <td>–</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>inline-source-map</td> <td>–</td> <td>–</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>hidden-source-map</td> <td>–</td> <td>–</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>nosources-source-map</td> <td>–</td> <td>–</td> <td>yes</td> <td>无源代码内容</td></tr></tbody></table> <p><strong>+++ 非常快速, ++ 快速, + 比较快, o 中等, - 比较慢, -- 慢</strong></p> <p><strong>一般在实际项目中，我个人推荐生产环境不使用或者使用 source-map（如果有 <a href="https://sentry.io/" target="_blank" rel="noopener noreferrer">Sentry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这类错误跟踪系统），开发环境使用cheap-module-eval-source-map。</strong></p> <h2 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h2> <p>本小节从 webpack 的配置文件webpack.config.js基本语法开始，分别介绍了配置的基本用法，mode、context、entry、output、target等 webpack 中的基础概念。希望大家读完本小节内容之后，能够动手实际操作一下。在记忆方面，可以</p> <blockquote><p>本小节 Webpack 相关面试题：</p> <ol><li>Webpack 的配置有几种写法，分别可以应用到什么场景？</li> <li>我们要开发一个 jQuery 插件、Vue 组件等，需要怎么配置 Webpack？</li> <li>Webpack 的占位符 [hash] 、[chunkhash] 和 [contenthash] 有什么区别和联系？最佳实践是什么？</li> <li>Webpack 的 SourceMap 有几种形式？分别有什么特点？SourceMap 配置的最佳实践是什么？</li> <li>什么是 bundle ，什么是 chunk，什么是 module？</li></ol></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/14/2019, 7:37:16 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/0004.html" class="prev">04 使用 webpack-cli 体验零配置打包</a></span> <span class="next"><a href="/0006.html">06 基础概念和常见配置项介绍（二）</a>→
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/assets/js/app.92625234.js" defer></script><script src="/assets/js/2.38d85b4c.js" defer></script><script src="/assets/js/10.1a50f243.js" defer></script>
  </body>
</html>
