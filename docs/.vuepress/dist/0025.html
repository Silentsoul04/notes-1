<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>胖大人的日常记事</title>
    <meta name="description" content="Just playing around">
    <link rel="icon" href="logo.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="mask-icon" href="logo.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="logo_144*144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.be15e0e1.css" as="style"><link rel="preload" href="/assets/js/app.745025a3.js" as="script"><link rel="preload" href="/assets/js/2.d6c01b35.js" as="script"><link rel="preload" href="/assets/js/30.a7a4f806.js" as="script"><link rel="prefetch" href="/assets/js/10.b15f60e2.js"><link rel="prefetch" href="/assets/js/11.535b2ad8.js"><link rel="prefetch" href="/assets/js/12.46ffc8b5.js"><link rel="prefetch" href="/assets/js/13.4b23805e.js"><link rel="prefetch" href="/assets/js/14.6e6cf41b.js"><link rel="prefetch" href="/assets/js/15.47414791.js"><link rel="prefetch" href="/assets/js/16.ecc1171d.js"><link rel="prefetch" href="/assets/js/17.c118399e.js"><link rel="prefetch" href="/assets/js/18.eea3e35b.js"><link rel="prefetch" href="/assets/js/19.b12d698f.js"><link rel="prefetch" href="/assets/js/20.a584b4e7.js"><link rel="prefetch" href="/assets/js/21.3e0bdf10.js"><link rel="prefetch" href="/assets/js/22.276850a1.js"><link rel="prefetch" href="/assets/js/23.b3efca3c.js"><link rel="prefetch" href="/assets/js/24.c7601923.js"><link rel="prefetch" href="/assets/js/25.39614ac1.js"><link rel="prefetch" href="/assets/js/26.60483ab2.js"><link rel="prefetch" href="/assets/js/27.bfb61d9d.js"><link rel="prefetch" href="/assets/js/28.7dadd6bc.js"><link rel="prefetch" href="/assets/js/29.59b2df76.js"><link rel="prefetch" href="/assets/js/3.ded4051d.js"><link rel="prefetch" href="/assets/js/31.48156b6a.js"><link rel="prefetch" href="/assets/js/32.e7ff8ffb.js"><link rel="prefetch" href="/assets/js/33.d17510e5.js"><link rel="prefetch" href="/assets/js/34.f00dca94.js"><link rel="prefetch" href="/assets/js/35.303cbcea.js"><link rel="prefetch" href="/assets/js/36.e8a1ac2f.js"><link rel="prefetch" href="/assets/js/37.e187a446.js"><link rel="prefetch" href="/assets/js/38.75296055.js"><link rel="prefetch" href="/assets/js/39.81ede555.js"><link rel="prefetch" href="/assets/js/4.eef6d0a5.js"><link rel="prefetch" href="/assets/js/40.92086d8f.js"><link rel="prefetch" href="/assets/js/41.77fe8ac2.js"><link rel="prefetch" href="/assets/js/42.ad77dce1.js"><link rel="prefetch" href="/assets/js/43.714ecbf7.js"><link rel="prefetch" href="/assets/js/44.bb453227.js"><link rel="prefetch" href="/assets/js/45.7bd9bdc7.js"><link rel="prefetch" href="/assets/js/5.ae17a9ef.js"><link rel="prefetch" href="/assets/js/6.41716a03.js"><link rel="prefetch" href="/assets/js/7.137caa55.js"><link rel="prefetch" href="/assets/js/8.f552d2b6.js"><link rel="prefetch" href="/assets/js/9.e9d1275f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.be15e0e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">胖大人的日常记事</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/0001.html" class="sidebar-link">01 开篇词 | 使用 Webpack 实现前端工程化</a></li><li><a href="/0002.html" class="sidebar-link">02 什么是 Webpack</a></li><li><a href="/0003.html" class="sidebar-link">03 Webpack 开发环境搭建</a></li><li><a href="/0004.html" class="sidebar-link">04 使用 webpack-cli 体验零配置打包</a></li><li><a href="/0005.html" class="sidebar-link">05 基础概念和常见配置项介绍（一）</a></li><li><a href="/0006.html" class="sidebar-link">06 基础概念和常见配置项介绍（二）</a></li><li><a href="/0007.html" class="sidebar-link">07 Webpack 中的模块化开发</a></li><li><a href="/0008.html" class="sidebar-link">08 在 Webpack 中使用 Babel 转换 JavaScript 代码</a></li><li><a href="/0009.html" class="sidebar-link">09 Webpack 中使用 TypeScript 开发项目</a></li><li><a href="/0010.html" class="sidebar-link">10 Webpack 中样式相关的配置</a></li><li><a href="/0011.html" class="sidebar-link">11 Webpack 中使用 lint 工具来保证代码风格和质量</a></li><li><a href="/0012.html" class="sidebar-link">12 使用 Webpack 管理项目中的静态资源</a></li><li><a href="/0013.html" class="sidebar-link">13 Webpack 中打包 HTML 和多页面配置</a></li><li><a href="/0014.html" class="sidebar-link">14 Webpack Dev Server 本地开发服务</a></li><li><a href="/0015.html" class="sidebar-link">15 Webpack 中配置React和Vue开发环境</a></li><li><a href="/0016.html" class="sidebar-link">16 Webpack 环境相关配置及配置文件拆分</a></li><li><a href="/0017.html" class="sidebar-link">17 Webpack 优化之体积优化</a></li><li><a href="/0018.html" class="sidebar-link">18 Webpack 优化之增强缓存命中率</a></li><li><a href="/0019.html" class="sidebar-link">19 使用 Webpack 的 splitChunks 功能来拆分代码</a></li><li><a href="/0020.html" class="sidebar-link">20 Webpack 优化之速度优化</a></li><li><a href="/0021.html" class="sidebar-link">21 使用 Webpack 的 Tree-Shaking</a></li><li><a href="/0022.html" class="sidebar-link">22 为你准备了一份 Webpack 工程化最佳实践总结</a></li><li><a href="/0023.html" class="sidebar-link">23 怎么调试 Webpack？</a></li><li><a href="/0024.html" class="sidebar-link">24 Tapable —— Webpack 的核心模块</a></li><li><a href="/0025.html" class="active sidebar-link">25 Webpack 的 Compiler 和 Compilation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/0025.html#compiler" class="sidebar-link">Compiler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/0025.html#注解1：resolver" class="sidebar-link">注解1：Resolver</a></li><li class="sidebar-sub-header"><a href="/0025.html#注解2：thiscompilation和compilation" class="sidebar-link">注解2：thisCompilation和compilation</a></li></ul></li><li class="sidebar-sub-header"><a href="/0025.html#compilation" class="sidebar-link">Compilation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/0025.html#compilation-钩子" class="sidebar-link">Compilation 钩子</a></li><li class="sidebar-sub-header"><a href="/0025.html#compilation-和-stats-对象" class="sidebar-link">Compilation 和 Stats 对象</a></li><li class="sidebar-sub-header"><a href="/0025.html#stats-对象数据结构" class="sidebar-link">Stats 对象数据结构</a></li><li class="sidebar-sub-header"><a href="/0025.html#module" class="sidebar-link">module</a></li><li class="sidebar-sub-header"><a href="/0025.html#chunk" class="sidebar-link">chunk</a></li><li class="sidebar-sub-header"><a href="/0025.html#asset" class="sidebar-link">asset</a></li></ul></li><li class="sidebar-sub-header"><a href="/0025.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/0026.html" class="sidebar-link">26 Webpack 工作流程</a></li><li><a href="/0027.html" class="sidebar-link">27 从 Webpack 的产出代码来看 Webpack 是怎么执行的</a></li><li><a href="/0028.html" class="sidebar-link">28 Webpack 的模块热替换做了什么？</a></li><li><a href="/0029.html" class="sidebar-link">29 实战：使用 PostCSS 打造移动适配方案</a></li><li><a href="/0030.html" class="sidebar-link">30 实战：手写一个 markdown-loader</a></li><li><a href="/0031.html" class="sidebar-link">31 实战：手写一个 prefetch-webpack-plugin 插件</a></li><li><a href="/0032.html" class="sidebar-link">32 实战：使用 Express 和中间件来实现 Webpack-dev-server</a></li><li><a href="/0033.html" class="sidebar-link">33 实战：使用 Stats 数据结构生成 Webpack 构建报告</a></li><li><a href="/0034.html" class="sidebar-link">34 实战：给 Webpack 项目添加 modern</a></li><li><a href="/0035.html" class="sidebar-link">35 Webpack 5.0</a></li><li><a href="/0036.html" class="sidebar-link">36 课程总结</a></li><li><a href="/0037.html" class="sidebar-link">37 附录：项目中常用的 loader</a></li><li><a href="/0038.html" class="sidebar-link">38 附录：项目中常用的插件</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img src="https://img.mukewang.com/5cd9645f000128e506400360.jpg" alt=""></p> <blockquote><p>与有肝胆人共事，从无字句处读书。</p> <p>               —— 周恩来</p></blockquote> <p>在 Webpack 工作流程 文章中已经提到过，Compiler 和 Compilation 都是继承自<a href="https://github.com/webpack/tapable" target="_blank" rel="noopener noreferrer">Tapable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，不同点是Compiler是每个 Webpack 的配置，对应一个Compiler对象，记录着整个 Webpack 的生命周期；在构建的过程中，每次构建都会产生一次Compilation，Compilation则是构建周期的产物。本文将进一步介绍Compiler和Compilation，通过本章节的学习，将会对 Webpack 构建过程有一个更加宏观的掌握。</p> <h2 id="compiler"><a href="#compiler" aria-hidden="true" class="header-anchor">#</a> Compiler</h2> <p><code>Compiler</code> 模块是 Webpack 最核心的模块。每次执行 Webpack 构建的时候，在 Webpack 内部，会首先实例化一个 Compiler 对象，然后调用它的 run 方法来开始一次完整的编译过程。我们直接使用 Webpack API <code>webpack(options)</code>的方式得到的就是一个<code>Compiler</code>实例化的对象，这时候 Webpack 并不会立即开始构建，需要我们手动执行<code>comipler.run()</code>才可以。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 只传入 config</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开始执行</span>
compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上面两句等价于</span>
<span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em><strong>Tips：</strong></em> 使用 <code>webpack-dev-server</code> API 方式时，只需要传入 <code>compiler</code> 对象给 <code>dev server</code> 即可，不需要手动执行<code>compiler.run()</code>。</p></blockquote> <p>我们如果要手动实例化一个Compiler对象，可以通过<code>const Compiler = webpack.Compiler</code>来获取它的类，一般只有一个父 Compiler，而子 Compiler 可以用来处理一些特殊的事件。</p> <p>在 webpack plugin 中，每个插件都有个apply方法。这个方法接收到的参数就是Compiler对象，我们可以通过在对应的钩子时机绑定处理函数来编写插件，下面主要介绍下Compiler对象的钩子。</p> <h4 id="compiler-钩子"><a href="#compiler-钩子" aria-hidden="true" class="header-anchor">#</a> Compiler 钩子</h4> <p>在Webpack 工作流程中，我们通过下面的代码，获取了对应的钩子名称：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历hooks，添加回调，输出`hookName`</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hookName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">[</span>hookName<span class="token punctuation">]</span><span class="token punctuation">.</span>tap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">[</span>hookName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'anyString'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">run -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hookName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发webpack的编译流程</span>
compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>得到<code>compiler.run()</code>之后的工作流程：</p> <div class="language- extra-class"><pre class="language-text"><code>run -&gt; beforeRun
run -&gt; run
run -&gt; normalModuleFactory
run -&gt; contextModuleFactory
run -&gt; beforeCompile
run -&gt; compile
run -&gt; thisCompilation
run -&gt; compilation
run -&gt; make
run -&gt; afterCompile
run -&gt; shouldEmit
run -&gt; emit
run -&gt; afterEmit
run -&gt; done
</code></pre></div><p>上面的方式只是输出<code>compiler.run()</code>之后的一部分钩子，Compiler 还有好多钩子。比如在 watch 模式下，还会有 <code>watchRun</code>、<code>watchClose</code> 和 <code>invalid</code>。我们如果要绑定某个钩子，则可以使用下面的方法来绑定：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>someHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'MyPlugin'</span><span class="token punctuation">,</span> <span class="token parameter">params</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面通过一个表格来说明下对应的关系：</p> <table><thead><tr><th>钩子名</th> <th>Tapable 类型</th> <th>触发时机</th> <th>传入 callback 的参数</th></tr></thead> <tbody><tr><td>entryOption</td> <td>SyncBailHook</td> <td>在 webpack 中的 entry 配置处理过之后</td> <td>context，entry</td></tr> <tr><td>afterPlugins</td> <td>SyncHook</td> <td>初始化完内置插件之后</td> <td>compiler</td></tr> <tr><td>afterResolvers</td> <td>SyncHook</td> <td>resolver 完成之后（后面解释resolver是什么）</td> <td>compiler</td></tr> <tr><td>environment</td> <td>SyncHook</td> <td>准备编译环境，webpack plugins配置初始化完成之后</td> <td>compiler</td></tr> <tr><td>afterEnvironment</td> <td>SyncHook</td> <td>编译环境准备好之后</td> <td>compiler</td></tr> <tr><td>beforeRun</td> <td>AsyncSeriesHook</td> <td>开始正式编译之前</td> <td>compiler</td></tr> <tr><td>run</td> <td>AsyncSeriesHook</td> <td>开始编译之后，读取 records 之前；监听模式触发watch-run</td> <td>compiler</td></tr> <tr><td>watchRun</td> <td>AsyncSeriesHook</td> <td>监听模式下，一个新的编译触发之后</td> <td>compiler</td></tr> <tr><td>normalModuleFactory</td> <td>SyncHook</td> <td>NormalModuleFactory 创建之后</td> <td>normalModuleFactory实例</td></tr> <tr><td>contextModuleFactory</td> <td>SyncHook</td> <td>ContextModuleFactory 创建之后</td> <td>contextModuleFactory实例</td></tr> <tr><td>beforeCompile</td> <td>AsyncSeriesHook</td> <td>compilation 实例化需要的参数创建完毕之后</td> <td>compilationParams</td></tr> <tr><td>compile</td> <td>SyncHook</td> <td>一次 compilation 编译创建之前</td> <td>compilationParams</td></tr> <tr><td>thisCompilation</td> <td>SyncHook</td> <td>触发 compilation 事件之前执行</td> <td>compilation，compilationParams</td></tr> <tr><td>compilation</td> <td>SyncHook</td> <td>compilation创建成功之后</td> <td>compilation，compilationParams</td></tr> <tr><td>make</td> <td>AsyncParallelHook</td> <td>完成编译之前</td> <td>compilation</td></tr> <tr><td>afterCompile</td> <td>AsyncSeriesHook</td> <td>完成编译和封存（seal）编译产出之后</td> <td>compilation</td></tr> <tr><td>shouldEmit</td> <td>SyncBailHook</td> <td>发布构建后资源之前触发，回调必须返回true/false，true则继续</td> <td>compilation</td></tr> <tr><td>emit</td> <td>AsyncSeriesHook</td> <td>生成资源到 output 目录之前</td> <td>compilation</td></tr> <tr><td>afterEmit</td> <td>AsyncSeriesHook</td> <td>生成资源到 output 目录之后</td> <td>compilation</td></tr> <tr><td>done</td> <td>AsyncSeriesHook</td> <td>compilation完成之后</td> <td>stats</td></tr> <tr><td>failed</td> <td>SyncHook</td> <td>compilation失败</td> <td>error</td></tr> <tr><td>invalid</td> <td>SyncHook</td> <td>监听模式下，编译无效时</td> <td>fileName，changeTime</td></tr> <tr><td>watchClose</td> <td>SyncHook</td> <td>监听模式停止</td> <td>无</td></tr></tbody></table> <blockquote><p><em><strong>Tips：</strong></em> 整个Compiler完整地展现了 Webpack 的构建流程：</p> <ol><li>准备阶段：make之前做的事情都属于准备阶段，这阶段的calback入参以compiler为主；</li> <li>编译阶段：这阶段以compilation的钩子为主，calback入参以compilation为主；</li> <li>产出阶段：这阶段从compilation开始，最后回到Compiler钩子上，calback传入参数是跟结果相关的数据，包括stats、error。</li></ol></blockquote> <h3 id="注解1：resolver"><a href="#注解1：resolver" aria-hidden="true" class="header-anchor">#</a> 注解1：Resolver</h3> <p>Compiler 的 Resolver 是指来自于enhanced-resolve模块，它主要功能是一个提供异步<code>require.resolve()</code>，即从哪里去查找文件的路径，可以通过Webpack的<code>resolve</code>和<code>resolveLoader</code>来配置。Compiler类有三种类型的内置 Resolver：</p> <ul><li>Normal：通过绝对路径或相对路径，解析一个模块；</li> <li>Context：通过给定的上下文（context）解析一个模块；</li> <li>Loader：解析一个 webpack loader。</li></ul> <h3 id="注解2：thiscompilation和compilation"><a href="#注解2：thiscompilation和compilation" aria-hidden="true" class="header-anchor">#</a> 注解2：thisCompilation和compilation</h3> <p>这里为什么会有 thisCompilation和compilation 两个钩子呢？其实是跟子编译（child compiler）有关， Compiler 实例通过 createChildCompiler 方法可以创建子编译实例 childCompiler。创建childCompiler时，childCompiler会复制 compiler 实例的任务点监听器。compilation的钩子会被复制，而thisCompilation 钩子则不会被复制。</p> <h2 id="compilation"><a href="#compilation" aria-hidden="true" class="header-anchor">#</a> Compilation</h2> <p>在 Compilation 阶段，模块会被加载(loaded)、封存(sealed)、优化(optimized)、分块(chunked)、哈希(hashed)和重新创建(restored)，Compilation 对象包含了当前的模块资源、编译生成资源、变化的文件等。当 Webpack 以监听（watch）模式运行时，每当检测到一个文件变化，一次新的 Compilation 将被创建。Compilation 对象也提供了很多事件回调供插件做扩展，通过 Compilation 也能读取到 Compiler 对象。</p> <h3 id="compilation-钩子"><a href="#compilation-钩子" aria-hidden="true" class="header-anchor">#</a> Compilation 钩子</h3> <p>在 Compilation 中处理的对象分别是<code>module</code>、<code>chunk</code>、<code>asset</code>，由 modules 组成<code>chunks</code>，由chunks生成<code>assets</code>，处理顺序是：<strong>module → modules → chunks → assets</strong>，先从单个 module 开始处理，查找依赖关系，最后完成单个 module 处理，完成全部modules 之后，开始 chunks 阶段处理，最后在根据优化配置，按需生成 assets。</p> <p>所以整个 Compilation 的生命周期钩子虽然比较多，但是大规律上是围绕这个顺序进行的，下面是大部分钩子表格如下，其中带★的是比较重要的钩子：</p> <table><thead><tr><th>钩子名</th> <th>Tapable 类型</th> <th>触发时机</th> <th>传入 callback 的参数</th></tr></thead> <tbody><tr><td>buildModule</td> <td>SyncHook</td> <td>在模块构建开始之前触发</td> <td>module</td></tr> <tr><td>rebuildModule</td> <td>SyncHook</td> <td>在重新构建一个模块之前触发</td> <td>module</td></tr> <tr><td>failedModule</td> <td>SyncHook</td> <td>模块构建失败时执行</td> <td>module，error</td></tr> <tr><td>succeedModule</td> <td>SyncHook</td> <td>模块构建成功时执行</td> <td>module</td></tr> <tr><td>finishModules</td> <td>SyncHook</td> <td>所有模块都完成构建</td> <td>module</td></tr> <tr><td>finishRebuildingModule</td> <td>SyncHook</td> <td>一个模块完成重新构建</td> <td>module</td></tr> <tr><td>seal</td> <td>SyncHook</td> <td>★编译（compilation）停止接收新模块时触发</td> <td>module</td></tr> <tr><td>unseal</td> <td>SyncHook</td> <td>编译（compilation）开始接收新模块时触发</td> <td>module</td></tr> <tr><td>optimizeDependencies</td> <td>SyncBailHook</td> <td>依赖优化开始时触发</td> <td>modules</td></tr> <tr><td>afterOptimizeDependencies</td> <td>SyncHook</td> <td>依赖优化结束时触发</td> <td>modules</td></tr> <tr><td>optimize</td> <td>SyncHook</td> <td>★优化阶段开始时触发</td> <td>modules</td></tr> <tr><td>optimizeModules</td> <td>SyncBailHook</td> <td>★模块的优化	modules</td> <td></td></tr> <tr><td>afterOptimizeModules</td> <td>SyncHook</td> <td>模块优化结束时触发</td> <td>modules</td></tr> <tr><td>optimizeChunks</td> <td>SyncBailHook</td> <td>★优化 chunks</td> <td>chunks</td></tr> <tr><td>afterOptimizeChunks</td> <td>SyncHook</td> <td>chunk 优化完成之后触发</td> <td>chunks</td></tr> <tr><td>optimizeTree</td> <td>AsyncSeriesHook</td> <td>异步优化依赖树</td> <td>chunks，modules</td></tr> <tr><td>afterOptimizeTree</td> <td>SyncHook</td> <td>异步优化依赖树完成时</td> <td>chunks，modules</td></tr> <tr><td>optimizeChunkModules</td> <td>SyncBailHook</td> <td>优化单个chunk中的 modules 开始</td> <td>chunks</td></tr> <tr><td>afterOptimizeChunkModules</td> <td>SyncHook</td> <td>优化单个chunk中的 modules 结束</td> <td>chunks</td></tr> <tr><td>shouldRecord</td> <td>SyncHook</td> <td></td> <td>chunks</td></tr> <tr><td>reviveModules</td> <td>SyncHook</td> <td>从 records 中恢复模块信息</td> <td>modules，records</td></tr> <tr><td>optimizeModuleOrder</td> <td>SyncHook</td> <td>将模块从最重要的到最不重要的进行排序</td> <td>chunks</td></tr> <tr><td>beforeModuleIds</td> <td>SyncHook</td> <td>处理 modulesId 之前</td> <td>modules</td></tr> <tr><td>moduleIds</td> <td>SyncHook</td> <td>处理 modulesId</td> <td>modules</td></tr> <tr><td>optimizeModuleIds</td> <td>SyncHook</td> <td>优化 modulesId</td> <td>chunks</td></tr> <tr><td>afterOptimizeModuleIds</td> <td>SyncHook</td> <td>优化 modulesId之后</td> <td>chunks</td></tr> <tr><td>reviveChunks</td> <td>SyncHook</td> <td>从 records 中恢复 chunk 信息</td> <td>modules，records</td></tr> <tr><td>optimizeChunkOrder</td> <td>SyncHook</td> <td>将 chunk 从最重要的到最不重要的进行排序</td> <td>chunks</td></tr> <tr><td>beforeOptimizeChunkIds</td> <td>SyncHook</td> <td>chunk id 优化之前触发</td> <td>chunks</td></tr> <tr><td>optimizeChunkIds</td> <td>SyncHook</td> <td>chunk id 优化开始触发</td> <td>chunks</td></tr> <tr><td>afterOptimizeChunkIds</td> <td>SyncHook</td> <td>chunk id 优化结束触发</td> <td>chunks</td></tr> <tr><td>recordModules</td> <td>SyncHook</td> <td>将模块信息存储到 records</td> <td>modules，records</td></tr> <tr><td>recordChunks</td> <td>SyncHook</td> <td>将 chunk 信息存储到 records</td> <td>chunks，records</td></tr> <tr><td>beforeHash</td> <td>SyncHook</td> <td>在编译被哈希（hashed）之前</td> <td>-</td></tr> <tr><td>afterHash</td> <td>SyncHook</td> <td>在编译被哈希（hashed）之后</td> <td>-</td></tr> <tr><td>record</td> <td>SyncHook</td> <td>将 compilation 相关信息存储到 records 中</td> <td>compilation，records</td></tr> <tr><td>beforeChunkAssets</td> <td>SyncHook</td> <td>在创建 chunk 资源（asset）之前</td> <td>chunks</td></tr> <tr><td>additionalChunkAssets</td> <td>SyncHook</td> <td>为 chunk 创建附加资源（asset）</td> <td>chunks</td></tr> <tr><td>additionalAssets</td> <td>AsyncSeriesHook</td> <td>★为编译（compilation）创建附加资源（asset）</td> <td>-</td></tr> <tr><td>optimizeChunkAssets</td> <td>AsyncSeriesHook</td> <td>★优化所有 chunk 资源（asset）</td> <td>chunks</td></tr> <tr><td>afterOptimizeChunkAssets</td> <td>SyncHook</td> <td>chunk 资源（asset）已经被优化</td> <td>chunks</td></tr> <tr><td>optimizeAssets</td> <td>AsyncSeriesHook</td> <td>★优化存储在 compilation.assets 中的所有资源（asset）</td> <td>assets</td></tr> <tr><td>afterOptimizeAssets</td> <td>SyncHook</td> <td>优化compilation.assets 中的所有资源（asset）之后</td> <td>assets</td></tr> <tr><td>moduleAsset</td> <td>SyncHook</td> <td>一个模块中的一个资源被添加到编译中</td> <td>module，filename</td></tr> <tr><td>chunkAsset</td> <td>SyncHook</td> <td>一个 chunk 中的一个资源被添加到编译中</td> <td>chunk，filename</td></tr> <tr><td>assetPath</td> <td>SyncWaterfallHook</td> <td>asset 路径确认之后</td> <td>filename，data</td></tr> <tr><td>childCompiler</td> <td>SyncHook</td> <td>子编译（compiler）触发</td> <td>childCompiler，compilerName，compilerIndex</td></tr> <tr><td>normalModuleLoader</td> <td>SyncHook</td> <td>★普通模块 loader，真正（一个接一个地）加载模块图（graph）中所有模块的函数</td> <td>loaderContext，module</td></tr></tbody></table> <h3 id="compilation-和-stats-对象"><a href="#compilation-和-stats-对象" aria-hidden="true" class="header-anchor">#</a> Compilation 和 Stats 对象</h3> <p>在 Webpack 的回调函数中会得到stats对象。这个对象实际来自于<code>Compilation.getStats()</code>，返回的是主要含有<code>modules</code>、<code>chunks</code>和<code>assets</code>三个属性值的对象。</p> <ul><li>modules：记录了所有解析后的模块；</li> <li>chunks：记录了所有chunk；</li> <li>assets：记录了所有要生成的文件。</li></ul> <p>Stats对象本质上来自于<code>lib/Stats.js</code>的类实例，常用的方法<code>stats.hasWarnings()</code>、<code>stats.hasErrors()</code>、<code>stats.toJson()</code>和<code>stats.toString()</code>都可以在这个类里面找到对应的实现。</p> <h3 id="stats-对象数据结构"><a href="#stats-对象数据结构" aria-hidden="true" class="header-anchor">#</a> Stats 对象数据结构</h3> <p>Stats 对象的 JSON 数据结构，除了通过<code>Compilation.getStats()</code>获得，还可以在 webpack 回调中，通过 <code>callback</code> 参数获得：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>还可以通过 webpack-cli 的选项将本次打包的 stats 存入一个 json 文件：<code>webpack --profile --json &gt; compilation-stats.json</code>。</p> <p>stats.toJson()得到的数据结构格式如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4.29.6&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 用来编译的 webpack 的版本</span>
    <span class="token property">&quot;hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11593e3b3ac85436984a&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 编译使用的 hash</span>
    <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">2469</span><span class="token punctuation">,</span> <span class="token comment">// 编译耗时 (ms)</span>
    <span class="token property">&quot;filteredModules&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 当 `exclude`传入`toJson` 函数时，统计被无视的模块的数量</span>
    <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// path to webpack 输出目录的 path 路径</span>
    <span class="token property">&quot;assetsByChunkName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 用作映射的 chunk 的名称</span>
        <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;web.js?h=11593e3b3ac85436984a&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;named-chunk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;named-chunk.web.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;other-chunk&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;other-chunk.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;other-chunk.css&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;assets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// asset 对象 (asset objects) 的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// chunk 对象 (chunk objects) 的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 模块对象 (module objects) 的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;errors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 错误字符串 (error string) 的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;warnings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 警告字符串 (warning string) 的数组</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里面除了编译基本信息、报错和 warnings 之外，就是<code>modules</code>、<code>chunks</code>和<code>assets</code>三个对应的数组，里面是单个的<code>module</code>、<code>chunk和asset</code>。</p> <blockquote><p><em><strong>Tips：</strong></em> stats.toJson可以指定要不要输出对应的数据。例如不想输出 modules 和 chunks，可以使用stats.toJson({modules: false, chunks: false})。</p></blockquote> <h3 id="module"><a href="#module" aria-hidden="true" class="header-anchor">#</a> module</h3> <p>在每个 module 中，我们可以得到它的所有信息，这些信息可以分为四大类：</p> <ul><li>基本信息：包括最基本的内容、大小、id；</li> <li>依赖关系：module.reasons对象描述了这个模块被加入依赖图表的理由，包含了引入的方式、引入的 module 信息及其对应代码在第几行第几列等，可以通过这个计算出 module 之间的依赖关系图表（graph）；</li> <li>chunks 和 assets 关系：module.chunks和module.assets包含到 chunks 和 assets 中的对应 id 等；</li> <li>被 webpack 处理的后的信息：包含module.failed、module.errors、module.warnings等。</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;assets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// asset对象 (asset objects)的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;built&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个模块会参与 Loaders , 解析, 并被编译</span>
    <span class="token property">&quot;cacheable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个模块是否会被缓存</span>
    <span class="token property">&quot;chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 包含这个模块的 chunks 的 id</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;errors&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 处理这个模块发现的错误的数量</span>
    <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 编译是否失败</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 这个模块的ID (类似于 `module.id`)</span>
    <span class="token property">&quot;identifier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(webpack)\\test\\browsertest\\lib\\index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// webpack内部使用的唯一的标识</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 实际文件的地址</span>
    <span class="token property">&quot;optional&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 每一个对这个模块的请求都会包裹在 `try... catch` 内 (与ESM无关)</span>
    <span class="token property">&quot;prefetched&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个模块是否会被 prefetched</span>
    <span class="token property">&quot;profile&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有关 `--profile` flag 的这个模块特有的编译数据 (ms)</span>
        <span class="token property">&quot;building&quot;</span><span class="token operator">:</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token comment">// 载入和解析</span>
        <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token number">242</span><span class="token punctuation">,</span> <span class="token comment">// 编译依赖</span>
        <span class="token property">&quot;factory&quot;</span><span class="token operator">:</span> <span class="token number">11</span> <span class="token comment">// 解决依赖</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reasons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 见下文描述</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">3593</span><span class="token punctuation">,</span> <span class="token comment">// 预估模块的大小 (byte)</span>
    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;// Should not break it...\r\nif(typeof...&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 字符串化的输入</span>
    <span class="token property">&quot;warnings&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 处理模块时警告的数量</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中module.reasons数据结构如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;33:24-93&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 导致这个被加入依赖图标的代码行数</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 所基于模块的相对地址 context</span>
    <span class="token property">&quot;moduleId&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 模块的 ID</span>
    <span class="token property">&quot;moduleIdentifier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(webpack)\\test\\browsertest\\lib\\index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块的地址</span>
    <span class="token property">&quot;moduleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可读性更好的模块名称 (用于 </span><span class="token string">&quot;更好的打印 (pretty-printing)&quot;</span>)
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;require.context&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 使用的请求的种类 (type of request)</span>
    <span class="token property">&quot;userRequest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../../cases&quot;</span> <span class="token comment">// 用来 `import` 或者 `require` 的源字符串</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="chunk"><a href="#chunk" aria-hidden="true" class="header-anchor">#</a> chunk</h3> <p>在每个 chunk 中，信息也可以分为四大类：</p> <ul><li>基本信息：包括最基本的内容、大小、id；</li> <li>来源：chunk.origins对象描述了这个模块被加入的理由，包含了引入的方式、引入的 module 信息及其对应代码在第几行第几列等，可以通过这个计算出 module 之间的依赖关系图表（graph）；</li> <li>引用关系：chunk.parents和chunk.children被引用和引用的 ids；</li> <li>包含和被包含：chunk.files和chunk.modules包含到 assets 和自己包含 modules 中信息等。</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;entry&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个 chunk 是否包含 webpack 的运行时</span>
    <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 一个包含这个 chunk 的文件名的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filteredModules&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 见上文的 结构</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 这个 chunk 的id</span>
    <span class="token property">&quot;initial&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个 chunk 是开始就要加载还是 懒加载(lazy-loading)</span>
    <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 模块对象 (module objects)的数组</span>
        <span class="token string">&quot;web.js?h=11593e3b3ac85436984a&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 包含在这个 chunk 内的 chunk 的名字的数组</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;origins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 下文详述</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 父 chunk 的 ids</span>
    <span class="token comment">// 生成 assets 的原因</span>
    <span class="token property">&quot;reason&quot;</span><span class="token operator">:</span> <span class="token string">&quot;split chunk (cache group: asyncVendors) (name: async)&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;170746935298270ad813&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 自己引用谁</span>
    <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 引用的顺序</span>
    <span class="token property">&quot;childrenByOrder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rendered&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个 chunk 是否会参与进编译</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">188057</span> <span class="token comment">// chunk 的大小(byte)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>chunk.origins对应的格式如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 具体是哪行生成了这个chunk</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(webpack)\\test\\browsertest\\lib\\index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块的位置</span>
    <span class="token property">&quot;moduleId&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 模块的ID</span>
    <span class="token property">&quot;moduleIdentifier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(webpack)\\test\\browsertest\\lib\\index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块的地址</span>
    <span class="token property">&quot;moduleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块的相对地址</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token comment">// chunk的名称</span>
    <span class="token property">&quot;reasons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 模块对象中`reason`的数组</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="asset"><a href="#asset" aria-hidden="true" class="header-anchor">#</a> asset</h3> <p>asset相对简单一些，内容如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;chunkNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 这个 asset 包含的 chunk</span>
    <span class="token property">&quot;chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 这个 asset 包含的 chunk 的 id</span>
    <span class="token property">&quot;emitted&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 表示这个 asset 是否会让它输出到 output 目录</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.web.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输出的文件名</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1058</span> <span class="token comment">// 文件的大小</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>本小节主要介绍 Webpack 中两个核心的类 Compiler 和 Compilation。Compiler 是每次 Webpack 全部生命周期的对象，而 Compilation 是 Webpack 中每次构建过程的生命周期对象，Compilation 是通过 Compiler 创建的实例。两个类都有自己生命周期，即有自己不同的 Hook，通过添加对应 Hook 事件，可以拿到各自生命周期关键数据和对象。Compilation 有个很重要的对象是 Stats 对象，通过这个对象可以得到 Webpack 打包后的所有module、chunk 和 assets 信息，通过分析Stats 对象可以得到很多有用的信息，比如 webpack-bundle-analyzer这类分析打包结果的插件都是通过分析 Stats 对象来得到分析报告的。另外 Webpack 中lib/Stats.js的源码也可以看下，对于分析打包结果和编写插件都有很大的启发。</p> <p><strong>本小节 Webpack 相关面试题：</strong></p> <ul><li>Webpack 的 Compiler 和 Compilation 对象有什么区别？</li> <li>Webpack 的 Compiler 和 Compilation 对象有哪些重要的 Hooks？</li> <li>怎么获取 Webpack 的 Compiler 和 Compilation 对象？</li> <li>Webpack 的 Stats 对象可以做什么？有什么用？怎么获取？</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/13/2019, 2:49:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/0024.html" class="prev">24 Tapable —— Webpack 的核心模块</a></span> <span class="next"><a href="/0026.html">26 Webpack 工作流程</a>→
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/assets/js/app.745025a3.js" defer></script><script src="/assets/js/2.d6c01b35.js" defer></script><script src="/assets/js/30.a7a4f806.js" defer></script>
  </body>
</html>
